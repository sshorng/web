<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>詞語賓果魔法屋 - 八年級形音加強版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        body {
            font-family: 'Noto Serif TC', serif;
            background: #0f0c29;
            background: -webkit-linear-gradient(to right, #24243e, #302b63, #0f0c29);
            background: linear-gradient(to right, #24243e, #302b63, #0f0c29);
            color: #f0f0f0;
            overflow-x: hidden;
        }

        .crystal-ball-container {
            position: relative;
            width: 250px;
            height: 250px;
            margin: 1rem auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .crystal-ball {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(120, 120, 255, 0.2) 50%, rgba(50, 50, 150, 0.5) 100%);
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 15px 5px rgba(255, 255, 255, 0.2),
                         0 0 35px 15px rgba(100, 100, 255, 0.3),
                         inset 0 0 20px 5px rgba(200, 200, 255, 0.3);
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .crystal-ball:hover:not(.disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 20px 8px rgba(255, 255, 255, 0.3),
                         0 0 45px 20px rgba(150, 150, 255, 0.4),
                         inset 0 0 25px 8px rgba(220, 220, 255, 0.4);
        }

        .crystal-ball-reflection {
            position: absolute;
            top: 15%;
            left: 20%;
            width: 50%;
            height: 25%;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: rotate(-30deg);
            filter: blur(5px);
        }
        
        .word-display {
            font-size: 2.2rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #e60073, 0 0 40px #e60073;
            opacity: 0;
            transform: scale(0.5);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            z-index: 10;
            padding: 0 10px;
            text-align: center;
            line-height: 1.4;
        }

        .word-display.show {
            opacity: 1;
            transform: scale(1);
        }
        
        .sparkle-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            border-radius: 50%;
        }

        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 5px white, 0 0 10px white;
            animation: sparkle-anim 1.5s linear;
            opacity: 0;
        }

        @keyframes sparkle-anim {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 4px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .custom-select {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
        }
        .custom-select option {
            background-color: #302b63;
            color: #fff;
        }

        .btn-magic {
            background: linear-gradient(45deg, #8a2be2, #4a00e0);
            border: none;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
        }
        .btn-magic:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.8);
        }
        .btn-magic:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 md:p-8">

    <div class="w-full max-w-7xl mx-auto flex flex-col">
        <!-- Header Section -->
        <header class="text-center w-full mb-8">
            <h1 class="text-4xl md:text-5xl font-bold mb-2 text-yellow-300" style="text-shadow: 0 0 10px #fde047;">
                詞語賓果魔法屋
            </h1>
            <p class="text-lg text-gray-300 mb-6">八年級形音義補充特訓 - 請選擇課次</p>

            <div class="flex flex-col sm:flex-row justify-center items-center gap-4 w-full max-w-md mx-auto">
                <select id="lesson-select" class="custom-select p-3 rounded-lg text-lg w-full sm:w-auto flex-grow">
                    <option value="">— — 請選擇課次 — —</option>
                </select>
                <button id="reset-btn" class="btn-magic text-white font-bold py-3 px-6 rounded-lg text-lg w-full sm:w-auto">
                    重新開始
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="w-full grid grid-cols-1 md:grid-cols-5 gap-8">
            <!-- Left Column -->
            <div class="flex flex-col items-center text-center md:col-span-2">
                <div id="crystal-ball-container" class="crystal-ball-container">
                    <div id="crystal-ball" class="crystal-ball disabled">
                        <div class="crystal-ball-reflection"></div>
                        <div id="word-display" class="word-display"></div>
                        <div id="sparkle-container" class="sparkle-container"></div>
                    </div>
                </div>
                <div id="counter-area" class="mt-4 text-xl text-yellow-400 h-8 font-bold"></div>
                <p id="message-area" class="text-gray-400 h-6"></p>
            </div>

            <!-- Right Column -->
            <div id="history-container" class="bg-black/20 p-4 md:p-6 rounded-xl shadow-lg h-[60vh] md:h-auto flex-col hidden md:flex md:col-span-3">
                <h2 class="text-2xl font-bold mb-4 border-b-2 border-yellow-300/50 pb-2 flex-shrink-0">已抽出詞語</h2>
                <div class="overflow-y-auto flex-grow pr-2">
                    <div id="history-list"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- 資料庫 (八年級形音講義new.pdf 版) ---
        // 權重規則：
        // 5: 四字成語、極難字 (如：黷、瀲)
        // 4: 易混淆字、較難詞 (如：尷尬、躊躇)
        // 3: 中等詞彙 (如：辨識、即使)
        // 2: 常見詞彙 (如：建議)
        // 1: 基礎詞彙 (如：雖然)

        const lessonsData = {
            "L1": {
                name: "第1課 一棵開花的樹",
                words: [
                    { word: "不慎", core_char: "慎", zhuyin: "ㄕㄣˋ", weight: 3 },
                    { word: "鎮定", core_char: "鎮", zhuyin: "ㄓㄣˋ", weight: 3 },
                    { word: "整天", core_char: "鎮", zhuyin: "ㄓㄣˋ", weight: 2 }, // 鎮日
                    { word: "縝密", core_char: "縝", zhuyin: "ㄓㄣˇ", weight: 4 },
                    { word: "嗔怒", core_char: "嗔", zhuyin: "ㄔㄣ", weight: 4 },
                    { word: "凋謝", core_char: "凋", zhuyin: "ㄉㄧㄠ", weight: 3 },
                    { word: "凋敝", core_char: "凋", zhuyin: "ㄉㄧㄠ", weight: 4 },
                    { word: "絲綢", core_char: "綢", zhuyin: "ㄔㄡˊ", weight: 2 },
                    { word: "地狹人稠", core_char: "稠", zhuyin: "ㄔㄡˊ", weight: 4 },
                    { word: "濃稠", core_char: "稠", zhuyin: "ㄔㄡˊ", weight: 3 },
                    { word: "惆悵", core_char: "惆", zhuyin: "ㄔㄡˊ", weight: 4 },
                    { word: "倜儻", core_char: "倜", zhuyin: "ㄊㄧˋ", weight: 4 },
                    { word: "紅塵", core_char: "塵", zhuyin: "ㄔㄣˊ", weight: 2 },
                    { word: "步人後塵", core_char: "塵", zhuyin: "ㄔㄣˊ", weight: 4 },
                    { word: "灰塵", core_char: "塵", zhuyin: "ㄔㄣˊ", weight: 1 },
                    { word: "塵封", core_char: "塵", zhuyin: "ㄔㄣˊ", weight: 3 },
                    { word: "情之所鍾", weight: 5 },
                    { word: "白頭偕老", weight: 5 },
                    { word: "山盟海誓", weight: 5 },
                    { word: "雙宿雙飛", weight: 5 },
                    { word: "海枯石爛", weight: 5 },
                    { word: "懸懸而望", weight: 5 },
                    { word: "眼穿腸斷", weight: 5 },
                    { word: "望穿秋水", weight: 5 },
                    { word: "朝思暮想", weight: 5 },
                    { word: "翹首引領", weight: 5 },
                    { word: "夢寐以求", weight: 5 },
                    { word: "拭目以待", weight: 5 },
                    { word: "大失所望", weight: 5 },
                    { word: "心灰意冷", weight: 5 },
                    { word: "垂頭喪氣", weight: 5 },
                    { word: "悵然若失", weight: 5 },
                    { word: "萬念俱灰", weight: 5 },
                    { word: "槁木死灰", weight: 5 }
                ]
            },
            "L2": {
                name: "第2課 樂府詩選—木蘭詩",
                words: [
                    { word: "織布", core_char: "織", zhuyin: "ㄓ", weight: 1 },
                    { word: "愛恨交織", core_char: "織", zhuyin: "ㄓ", weight: 3 },
                    { word: "身居要職", core_char: "職", zhuyin: "ㄓˊ", weight: 3 },
                    { word: "職掌", core_char: "職", zhuyin: "ㄓˊ", weight: 2 },
                    { word: "獨樹一幟", core_char: "幟", zhuyin: "ㄓˋ", weight: 4 },
                    { word: "熾烈", core_char: "熾", zhuyin: "ㄔˋ", weight: 4 },
                    { word: "別出機杼", core_char: "杼", zhuyin: "ㄓㄨˋ", weight: 5 },
                    { word: "各抒己見", core_char: "抒", zhuyin: "ㄕㄨ", weight: 4 },
                    { word: "朔氣", core_char: "朔", zhuyin: "ㄕㄨㄛˋ", weight: 3 },
                    { word: "朔日", core_char: "朔", zhuyin: "ㄕㄨㄛˋ", weight: 3 },
                    { word: "雕塑", core_char: "塑", zhuyin: "ㄙㄨˋ", weight: 2 },
                    { word: "塑造形象", core_char: "塑", zhuyin: "ㄙㄨˋ", weight: 2 },
                    { word: "追本溯源", core_char: "溯", zhuyin: "ㄙㄨˋ", weight: 4 },
                    { word: "溯溪", core_char: "溯", zhuyin: "ㄙㄨˋ", weight: 3 },
                    { word: "鬢毛", core_char: "鬢", zhuyin: "ㄅㄧㄣˋ", weight: 4 },
                    { word: "不讓鬚眉", core_char: "鬚", zhuyin: "ㄒㄩ", weight: 4 },
                    { word: "髮髻", core_char: "髻", zhuyin: "ㄐㄧˋ", weight: 4 },
                    { word: "兩兔傍地走", core_char: "傍", zhuyin: "ㄅㄤˋ", weight: 4 },
                    { word: "英鎊", core_char: "鎊", zhuyin: "ㄅㄤˋ", weight: 2 },
                    { word: "榜單", core_char: "榜", zhuyin: "ㄅㄤˇ", weight: 2 },
                    { word: "兩旁", core_char: "旁", zhuyin: "ㄆㄤˊ", weight: 1 },
                    { word: "旁門左道", core_char: "旁", zhuyin: "ㄆㄤˊ", weight: 4 },
                    { word: "所向披靡", weight: 5 },
                    { word: "勢如破竹", weight: 5 },
                    { word: "旌旗蔽空", weight: 5 },
                    { word: "潰不成軍", weight: 5 },
                    { word: "節節敗退", weight: 5 },
                    { word: "兵馬倥偬", weight: 5 },
                    { word: "兵荒馬亂", weight: 5 },
                    { word: "兵連禍結", weight: 5 },
                    { word: "厲兵秣馬", weight: 5 },
                    { word: "嚴陣以待", weight: 5 },
                    { word: "解甲歸田", weight: 5 },
                    { word: "投筆從戎", weight: 5 }
                ]
            },
            "L3": {
                name: "第3課 情緒是生命的指引",
                words: [
                    { word: "淹沒", core_char: "淹", zhuyin: "ㄧㄢ", weight: 3 },
                    { word: "醃梅子", core_char: "醃", zhuyin: "ㄧㄢ", weight: 3 },
                    { word: "掩鼻", core_char: "掩", zhuyin: "ㄧㄢˇ", weight: 3 },
                    { word: "掩門", core_char: "掩", zhuyin: "ㄧㄢˇ", weight: 2 },
                    { word: "茅庵", core_char: "庵", zhuyin: "ㄢ", weight: 4 },
                    { word: "尼姑庵", core_char: "庵", zhuyin: "ㄢ", weight: 4 },
                    { word: "既定", core_char: "既", zhuyin: "ㄐㄧˋ", weight: 3 },
                    { word: "既美且高", core_char: "既", zhuyin: "ㄐㄧˋ", weight: 3 },
                    { word: "若即若離", core_char: "即", zhuyin: "ㄐㄧˊ", weight: 5 },
                    { word: "即位", core_char: "即", zhuyin: "ㄐㄧˊ", weight: 3 },
                    { word: "非此即彼", core_char: "即", zhuyin: "ㄐㄧˊ", weight: 4 },
                    { word: "一觸即發", core_char: "即", zhuyin: "ㄐㄧˊ", weight: 5 },
                    { word: "內疚", core_char: "疚", zhuyin: "ㄐㄧㄡˋ", weight: 4 },
                    { word: "咎由自取", core_char: "咎", zhuyin: "ㄐㄧㄡù", weight: 5 },
                    { word: "引咎辭職", core_char: "咎", zhuyin: "ㄐㄧㄡù", weight: 5 },
                    { word: "既往不咎", core_char: "咎", zhuyin: "ㄐㄧㄡù", weight: 5 },
                    { word: "針灸", core_char: "灸", zhuyin: "ㄐㄧㄡˇ", weight: 4 },
                    { word: "一艘船", core_char: "艘", zhuyin: "ㄙㄠ", weight: 2 },
                    { word: "大嫂", core_char: "嫂", zhuyin: "ㄙㄠˇ", weight: 2 },
                    { word: "搜尋", core_char: "搜", zhuyin: "ㄙㄡ", weight: 2 },
                    { word: "搜身", core_char: "搜", zhuyin: "ㄙㄡ", weight: 2 },
                    { word: "餿水", core_char: "餿", zhuyin: "ㄙㄡ", weight: 3 },
                    { word: "餿主意", core_char: "餿", zhuyin: "ㄙㄡ", weight: 3 },
                    { word: "冷風颼颼", core_char: "颼", zhuyin: "ㄙㄡ", weight: 4 },
                    { word: "寒颼颼", core_char: "颼", zhuyin: "ㄙㄡ", weight: 4 },
                    { word: "瘦弱", core_char: "瘦", zhuyin: "ㄕㄡˋ", weight: 2 },
                    { word: "氣候", core_char: "候", zhuyin: "ㄏㄡˋ", weight: 2 },
                    { word: "逾時不候", core_char: "候", zhuyin: "ㄏㄡˋ", weight: 4 },
                    { word: "伺候", core_char: "候", zhuyin: "ㄏㄡˋ", weight: 3 },
                    { word: "不禁", core_char: "禁", zhuyin: "ㄐㄧㄣ", weight: 3 },
                    { word: "嚴禁煙火", core_char: "禁", zhuyin: "ㄐㄧㄣˋ", weight: 3 },
                    { word: "囚禁", core_char: "禁", zhuyin: "ㄐㄧㄣˋ", weight: 3 },
                    { word: "禁忌", core_char: "禁", zhuyin: "ㄐㄧㄣˋ", weight: 3 },
                    { word: "門禁", core_char: "禁", zhuyin: "ㄐㄧㄣˋ", weight: 2 },
                    { word: "緊繃", core_char: "繃", zhuyin: "ㄅㄥ", weight: 3 },
                    { word: "繃著臉", core_char: "繃", zhuyin: "ㄅㄥˇ", weight: 3 },
                    { word: "拉鍊繃了", core_char: "繃", zhuyin: "ㄅㄥˋ", weight: 3 }
                ]
            },
            "自1": {
                name: "自學1 運動家的風度",
                words: [
                    { word: "陶鑄", core_char: "鑄", zhuyin: "ㄓㄨˋ", weight: 3 },
                    { word: "鑄成大錯", core_char: "鑄", zhuyin: "ㄓㄨˋ", weight: 4 },
                    { word: "躊躇", core_char: "躊", zhuyin: "ㄔㄡˊ", weight: 4 },
                    { word: "茲若人之儔乎", core_char: "儔", zhuyin: "ㄔㄡˊ", weight: 5 },
                    { word: "作揖", core_char: "揖", zhuyin: "ㄧ", weight: 4 },
                    { word: "編輯", core_char: "輯", zhuyin: "ㄐㄧˊ", weight: 2 },
                    { word: "通緝", core_char: "緝", zhuyin: "ㄑㄧˋ", weight: 3 },
                    { word: "萬目睽睽", core_char: "睽", zhuyin: "ㄎㄨㄟˊ", weight: 5 },
                    { word: "睽違", core_char: "睽", zhuyin: "ㄎㄨㄟˊ", weight: 4 },
                    { word: "揆情度理", core_char: "揆", zhuyin: "ㄎㄨㄟˊ", weight: 5 },
                    { word: "閣揆", core_char: "揆", zhuyin: "ㄎㄨㄟˊ", weight: 4 },
                    { word: "向日葵", core_char: "葵", zhuyin: "ㄎㄨㄟˊ", weight: 2 },
                    { word: "癸巳年", core_char: "癸", zhuyin: "ㄍㄨㄟˇ", weight: 3 },
                    { word: "悻悻然", core_char: "悻", zhuyin: "ㄒㄧㄥˋ", weight: 4 },
                    { word: "倖存", core_char: "倖", zhuyin: "ㄒㄧㄥˋ", weight: 3 },
                    { word: "下而飲", core_char: "飲", zhuyin: "ㄧㄣˋ", weight: 4 },
                    { word: "茹毛飲血", core_char: "飲", zhuyin: "ㄧㄣˇ", weight: 5 },
                    { word: "痛飲", core_char: "飲", zhuyin: "ㄧㄣˇ", weight: 3 },
                    { word: "飲恨", core_char: "飲", zhuyin: "ㄧㄣˇ", weight: 3 },
                    { word: "勝利", core_char: "勝", zhuyin: "ㄕㄥˋ", weight: 2 },
                    { word: "略勝一籌", core_char: "勝", zhuyin: "ㄕㄥˋ", weight: 5 },
                    { word: "名山勝景", core_char: "勝", zhuyin: "ㄕㄥˋ", weight: 4 },
                    { word: "不勝其擾", core_char: "勝", zhuyin: "ㄕㄥ", weight: 4 },
                    { word: "不勝枚舉", core_char: "勝", zhuyin: "ㄕㄥ", weight: 5 },
                    { word: "獨步天下", weight: 5 },
                    { word: "無與倫比", weight: 5 },
                    { word: "名列前茅", weight: 5 },
                    { word: "冠絕古今", weight: 5 },
                    { word: "舉世無雙", weight: 5 },
                    { word: "風華絕代", weight: 5 },
                    { word: "無出其右", weight: 5 },
                    { word: "三元及第", weight: 5 },
                    { word: "首屈一指", weight: 5 },
                    { word: "獨占鰲頭", weight: 5 }
                ]
            },
            "L4": {
                name: "第4課 張釋之執法",
                words: [
                    { word: "屬之廷尉", core_char: "屬", zhuyin: "ㄓㄨˇ", weight: 3 },
                    { word: "附屬", core_char: "屬", zhuyin: "ㄕㄨˇ", weight: 3 },
                    { word: "親屬", core_char: "屬", zhuyin: "ㄕㄨˇ", weight: 2 },
                    { word: "囑咐", core_char: "囑", zhuyin: "ㄓㄨˇ", weight: 3 },
                    { word: "高瞻遠矚", core_char: "矚", zhuyin: "ㄓㄨˇ", weight: 5 },
                    { word: "銷聲匿跡", core_char: "匿", zhuyin: "ㄋㄧˋ", weight: 5 },
                    { word: "親暱", core_char: "暱", zhuyin: "ㄋㄧˋ", weight: 3 },
                    { word: "誅殺", core_char: "誅", zhuyin: "ㄓㄨ", weight: 3 },
                    { word: "口誅筆伐", core_char: "誅", zhuyin: "ㄓㄨ", weight: 5 },
                    { word: "錙銖必較", core_char: "銖", zhuyin: "ㄓㄨ", weight: 5 },
                    { word: "懸殊", core_char: "殊", zhuyin: "ㄕㄨ", weight: 3 },
                    { word: "殊榮", core_char: "殊", zhuyin: "ㄕㄨ", weight: 3 },
                    { word: "傾斜", core_char: "傾", zhuyin: "ㄑㄧㄥ", weight: 2 },
                    { word: "傾囊相授", core_char: "傾", zhuyin: "ㄑㄧㄥ", weight: 5 },
                    { word: "傾心", core_char: "傾", zhuyin: "ㄑㄧㄥ", weight: 2 },
                    { word: "公頃", core_char: "頃", zhuyin: "ㄑㄧㄥˇ", weight: 2 },
                    { word: "頃刻", core_char: "頃", zhuyin: "ㄑㄧㄥˇ", weight: 4 },
                    { word: "嚴刑峻法", weight: 5 },
                    { word: "貪贓枉法", weight: 5 },
                    { word: "違法亂紀", weight: 5 },
                    { word: "知法犯法", weight: 5 },
                    { word: "以身試法", weight: 5 },
                    { word: "目無法紀", weight: 5 },
                    { word: "逍遙法外", weight: 5 },
                    { word: "奉公守法", weight: 5 },
                    { word: "狡兔死良狗烹", weight: 5 },
                    { word: "無顏見江東父老", weight: 5 },
                    { word: "燕雀安知鴻鵠之志", weight: 5 },
                    { word: "桃李不言下自成蹊", weight: 5 },
                    { word: "當斷不斷反受其亂", weight: 5 },
                    { word: "智者千慮必有一失", weight: 5 }
                ]
            },
            "L5": {
                name: "第5課 我所知道的康橋",
                words: [
                    { word: "滂沱", core_char: "滂", zhuyin: "ㄆㄤ", weight: 3 },
                    { word: "氣勢磅礴", core_char: "磅", zhuyin: "ㄆㄤ", weight: 5 },
                    { word: "磅秤", core_char: "磅", zhuyin: "ㄅㄤˋ", weight: 2 },
                    { word: "毀謗", core_char: "謗", zhuyin: "ㄅㄤˋ", weight: 3 },
                    { word: "霹靂", core_char: "霹", zhuyin: "ㄆㄧ", weight: 3 },
                    { word: "劈柴", core_char: "劈", zhuyin: "ㄆㄧ", weight: 2 },
                    { word: "天打雷劈", core_char: "劈", zhuyin: "ㄆㄧ", weight: 3 },
                    { word: "劈面", core_char: "劈", zhuyin: "ㄆㄧ", weight: 3 },
                    { word: "餓虎攫羊", core_char: "攫", zhuyin: "ㄐㄩㄝˊ", weight: 5 },
                    { word: "雀躍", core_char: "躍", zhuyin: "ㄩㄝˋ", weight: 3 },
                    { word: "矍然", core_char: "矍", zhuyin: "ㄐㄩㄝˊ", weight: 5 },
                    { word: "震懾", core_char: "懾", zhuyin: "ㄓㄜˊ", weight: 4 },
                    { word: "攝影", core_char: "攝", zhuyin: "ㄕㄜˋ", weight: 2 },
                    { word: "躡手躡腳", core_char: "躡", zhuyin: "ㄋㄧㄝˋ", weight: 5 },
                    { word: "聶先生", core_char: "聶", zhuyin: "ㄋㄧㄝˋ", weight: 3 },
                    { word: "囁嚅", core_char: "囁", zhuyin: "ㄋㄧㄝˋ", weight: 5 },
                    { word: "肆虐", core_char: "肆", zhuyin: "ㄙˋ", weight: 3 },
                    { word: "肆無忌憚", core_char: "肆", zhuyin: "ㄙˋ", weight: 5 },
                    { word: "肆拾圓", core_char: "肆", zhuyin: "ㄙˋ", weight: 2 },
                    { word: "酒肆", core_char: "肆", zhuyin: "ㄙˋ", weight: 4 },
                    { word: "肄業", core_char: "肄", zhuyin: "ㄧˋ", weight: 4 },
                    { word: "雷霆萬鈞", core_char: "鈞", zhuyin: "ㄐㄩㄣ", weight: 5 },
                    { word: "勢均力敵", core_char: "均", zhuyin: "ㄐㄩㄣ", weight: 5 },
                    { word: "老少均安", core_char: "均", zhuyin: "ㄐㄩㄣ", weight: 3 },
                    { word: "勻稱", core_char: "勻", zhuyin: "ㄩㄣˊ", weight: 3 },
                    { word: "勻出時間", core_char: "勻", zhuyin: "ㄩㄣˊ", weight: 3 },
                    { word: "洩洪", core_char: "洩", zhuyin: "ㄒㄧㄝˋ", weight: 3 },
                    { word: "發洩", core_char: "洩", zhuyin: "ㄒㄧㄝˋ", weight: 2 },
                    { word: "洩密", core_char: "洩", zhuyin: "ㄒㄧㄝˋ", weight: 2 },
                    { word: "一瀉千里", core_char: "瀉", zhuyin: "ㄒㄧㄝˋ", weight: 5 },
                    { word: "腹瀉", core_char: "瀉", zhuyin: "ㄒㄧㄝˋ", weight: 2 },
                    { word: "行潦", core_char: "潦", zhuyin: "ㄌㄠˇ", weight: 4 },
                    { word: "潦倒", core_char: "潦", zhuyin: "ㄌㄧㄠˊ", weight: 3 },
                    { word: "撩起裙子", core_char: "撩", zhuyin: "ㄌㄧㄠ", weight: 2 },
                    { word: "姿態撩人", core_char: "撩", zhuyin: "ㄌㄧㄠˊ", weight: 4 },
                    { word: "星火燎原", core_char: "燎", zhuyin: "ㄌㄧㄠˊ", weight: 5 }
                ]
            },
            "L6": {
                name: "第6課 迷途羔羊——弗氏海豚",
                words: [
                    { word: "迷途羔羊", core_char: "羔", zhuyin: "ㄍㄠ", weight: 3 },
                    { word: "窯洞", core_char: "窯", zhuyin: "ㄧㄠˊ", weight: 3 },
                    { word: "瓦窯", core_char: "窯", zhuyin: "ㄧㄠˊ", weight: 3 },
                    { word: "清晰", core_char: "晰", zhuyin: "ㄒㄧ", weight: 2 },
                    { word: "白皙", core_char: "皙", zhuyin: "ㄒㄧ", weight: 4 },
                    { word: "分崩離析", core_char: "析", zhuyin: "ㄒㄧ", weight: 5 },
                    { word: "解析", core_char: "析", zhuyin: "ㄒㄧ", weight: 2 },
                    { word: "深奧", core_char: "奧", zhuyin: "ㄠˋ", weight: 3 },
                    { word: "蘇澳", core_char: "澳", zhuyin: "ㄠˋ", weight: 2 },
                    { word: "懊惱", core_char: "懊", zhuyin: "ㄠˋ", weight: 3 },
                    { word: "倉卒", core_char: "卒", zhuyin: "ㄘㄨˋ", weight: 4 },
                    { word: "士卒", core_char: "卒", zhuyin: "ㄗㄨˊ", weight: 3 },
                    { word: "販夫走卒", core_char: "卒", zhuyin: "ㄗㄨˊ", weight: 5 },
                    { word: "病卒", core_char: "卒", zhuyin: "ㄗㄨˊ", weight: 3 },
                    { word: "卒業", core_char: "卒", zhuyin: "ㄗㄨˊ", weight: 3 },
                    { word: "猝死", core_char: "猝", zhuyin: "ㄘㄨˋ", weight: 3 },
                    { word: "純粹", core_char: "粹", zhuyin: "ㄘㄨㄟˋ", weight: 3 },
                    { word: "憔悴", core_char: "悴", zhuyin: "ㄘㄨㄟˋ", weight: 4 },
                    { word: "淬鍊", core_char: "淬", zhuyin: "ㄘㄨㄟˋ", weight: 5 },
                    { word: "人文薈萃", core_char: "萃", zhuyin: "ㄘㄨㄟˋ", weight: 5 },
                    { word: "盲從", core_char: "盲", zhuyin: "ㄇㄤˊ", weight: 3 },
                    { word: "盲人", core_char: "盲", zhuyin: "ㄇㄤˊ", weight: 2 },
                    { word: "文盲", core_char: "盲", zhuyin: "ㄇㄤˊ", weight: 2 },
                    { word: "病入膏肓", core_char: "肓", zhuyin: "ㄏㄨㄤ", weight: 5 },
                    { word: "潛水", core_char: "潛", zhuyin: "ㄑㄧㄢˊ", weight: 2 },
                    { word: "潛藏", core_char: "潛", zhuyin: "ㄑㄧㄢˊ", weight: 3 },
                    { word: "僭越", core_char: "僭", zhuyin: "ㄐㄧㄢˋ", weight: 5 },
                    { word: "髮簪", core_char: "簪", zhuyin: "ㄗㄢ", weight: 4 },
                    { word: "深邃", core_char: "邃", zhuyin: "ㄙㄨㄟˋ", weight: 4 },
                    { word: "隧道", core_char: "隧", zhuyin: "ㄙㄨㄟˋ", weight: 2 }
                ]
            },
            "自2": {
                name: "自學2 拍痰",
                words: [
                    { word: "胸膛", core_char: "膛", zhuyin: "ㄊㄤˊ", weight: 3 },
                    { word: "瞠目結舌", core_char: "瞠", zhuyin: "ㄔㄥ", weight: 5 },
                    { word: "隱晦", core_char: "晦", zhuyin: "ㄏㄨㄟˋ", weight: 4 },
                    { word: "風雨如晦", core_char: "晦", zhuyin: "ㄏㄨㄟˋ", weight: 5 },
                    { word: "教誨", core_char: "誨", zhuyin: "ㄏㄨㄟˋ", weight: 3 },
                    { word: "悔恨", core_char: "悔", zhuyin: "ㄏㄨㄟˇ", weight: 2 },
                    { word: "侮辱", core_char: "侮", zhuyin: "ㄨˇ", weight: 3 },
                    { word: "睡眼惺忪", core_char: "忪", zhuyin: "ㄙㄨㄥ", weight: 5 },
                    { word: "松樹", core_char: "松", zhuyin: "ㄙㄨㄥ", weight: 1 },
                    { word: "訴訟", core_char: "訟", zhuyin: "ㄙㄨㄥˋ", weight: 3 },
                    { word: "深邃", core_char: "邃", zhuyin: "ㄙㄨㄟˋ", weight: 4 },
                    { word: "諸事不遂", core_char: "遂", zhuyin: "ㄙㄨㄟˋ", weight: 4 },
                    { word: "半身不遂", core_char: "遂", zhuyin: "ㄙㄨㄟˋ", weight: 4 },
                    { word: "未遂", core_char: "遂", zhuyin: "ㄙㄨㄟˋ", weight: 3 },
                    { word: "追逐", core_char: "逐", zhuyin: "ㄓㄨˊ", weight: 2 },
                    { word: "驅逐出境", core_char: "逐", zhuyin: "ㄓㄨˊ", weight: 3 },
                    { word: "角逐", core_char: "逐", zhuyin: "ㄓㄨˊ", weight: 3 },
                    { word: "逐年增加", core_char: "逐", zhuyin: "ㄓㄨˊ", weight: 3 },
                    { word: "橋梁", core_char: "梁", zhuyin: "ㄌㄧㄤˊ", weight: 3 },
                    { word: "鼻梁", core_char: "梁", zhuyin: "ㄌㄧㄤˊ", weight: 3 },
                    { word: "高粱", core_char: "粱", zhuyin: "ㄌㄧㄤˊ", weight: 3 },
                    { word: "看照", core_char: "看", zhuyin: "ㄎㄢ", weight: 3 },
                    { word: "看見", core_char: "看", zhuyin: "ㄎㄢˋ", weight: 1 },
                    { word: "刮目相看", core_char: "看", zhuyin: "ㄎㄢˋ", weight: 4 },
                    { word: "看診", core_char: "看", zhuyin: "ㄎㄢˋ", weight: 2 },
                    { word: "婚喪喜慶", core_char: "喪", zhuyin: "ㄙㄤ", weight: 4 },
                    { word: "喪盡天良", core_char: "喪", zhuyin: "ㄙㄤˋ", weight: 4 }
                ]
            },
            "L7": {
                name: "第7課 陋室銘",
                words: [
                    { word: "苔痕上階綠", core_char: "階", zhuyin: "ㄐㄧㄝ", weight: 3 },
                    { word: "白頭偕老", core_char: "偕", zhuyin: "ㄒㄧㄝ", weight: 5 },
                    { word: "詼諧", core_char: "諧", zhuyin: "ㄒㄧㄝˊ", weight: 4 },
                    { word: "博學鴻儒", core_char: "儒", zhuyin: "ㄖㄨˊ", weight: 5 },
                    { word: "蠕動", core_char: "蠕", zhuyin: "ㄖㄨˊ", weight: 3 },
                    { word: "簡牘", core_char: "牘", zhuyin: "ㄉㄨˊ", weight: 5 },
                    { word: "貪汙瀆職", core_char: "瀆", zhuyin: "ㄉㄨˊ", weight: 5 },
                    { word: "初生之犢不畏虎", core_char: "犢", zhuyin: "ㄉㄨˊ", weight: 5 },
                    { word: "買櫝還珠", core_char: "櫝", zhuyin: "ㄉㄨˊ", weight: 5 },
                    { word: "窮兵黷武", core_char: "黷", zhuyin: "ㄉㄨˊ", weight: 5 },
                    { word: "案牘勞形", core_char: "形", zhuyin: "ㄒㄧㄥˊ", weight: 5 },
                    { word: "形象", core_char: "形", zhuyin: "ㄒㄧㄥˊ", weight: 2 },
                    { word: "情形", core_char: "形", zhuyin: "ㄒㄧㄥˊ", weight: 2 },
                    { word: "喜形於色", core_char: "形", zhuyin: "ㄒㄧㄥˊ", weight: 5 },
                    { word: "模型", core_char: "型", zhuyin: "ㄒㄧㄥˊ", weight: 2 },
                    { word: "典型", core_char: "型", zhuyin: "ㄒㄧㄥˊ", weight: 3 },
                    { word: "血型", core_char: "型", zhuyin: "ㄒㄧㄥˊ", weight: 2 },
                    { word: "三顧茅廬", core_char: "廬", zhuyin: "ㄌㄨˊ", weight: 5 },
                    { word: "蘆葦", core_char: "蘆", zhuyin: "ㄌㄨˊ", weight: 2 },
                    { word: "另起爐灶", core_char: "爐", zhuyin: "ㄌㄨˊ", weight: 5 },
                    { word: "惟吾德馨", core_char: "惟", zhuyin: "ㄨㄟˊ", weight: 4 },
                    { word: "惟膀子疼痛", core_char: "惟", zhuyin: "ㄨㄟˊ", weight: 4 },
                    { word: "惟聞女嘆息", core_char: "惟", zhuyin: "ㄨㄟˊ", weight: 4 },
                    { word: "思惟", core_char: "惟", zhuyin: "ㄨㄟˊ", weight: 3 },
                    { word: "素琴", core_char: "素", zhuyin: "ㄙㄨˋ", weight: 3 },
                    { word: "留蚊於素帳中", core_char: "素", zhuyin: "ㄙㄨˋ", weight: 4 },
                    { word: "樸素", core_char: "素", zhuyin: "ㄙㄨˋ", weight: 2 },
                    { word: "素行不良", core_char: "素", zhuyin: "ㄙㄨˋ", weight: 4 },
                    { word: "因素", core_char: "素", zhuyin: "ㄙㄨˋ", weight: 2 },
                    { word: "尸位素餐", core_char: "素", zhuyin: "ㄙㄨˋ", weight: 5 },
                    { word: "素不相識", core_char: "素", zhuyin: "ㄙㄨˋ", weight: 4 }
                ]
            },
            "L8": {
                name: "第8課 成功是失敗之母",
                words: [
                    { word: "巔峰", core_char: "巔", zhuyin: "ㄉㄧㄢ", weight: 3 },
                    { word: "瘋癲", core_char: "癲", zhuyin: "ㄉㄧㄢ", weight: 4 },
                    { word: "賦詩", core_char: "賦", zhuyin: "ㄈㄨˋ", weight: 3 },
                    { word: "賦斂", core_char: "賦", zhuyin: "ㄈㄨˋ", weight: 4 },
                    { word: "稟賦", core_char: "賦", zhuyin: "ㄈㄨˋ", weight: 4 },
                    { word: "威武", core_char: "武", zhuyin: "ㄨˇ", weight: 2 },
                    { word: "武器", core_char: "武", zhuyin: "ㄨˇ", weight: 2 },
                    { word: "鞭笞", core_char: "笞", zhuyin: "ㄔ", weight: 5 },
                    { word: "苔蘚", core_char: "苔", zhuyin: "ㄊㄞˊ", weight: 4 },
                    { word: "收斂", core_char: "斂", zhuyin: "ㄌㄧㄢˋ", weight: 3 },
                    { word: "水光瀲豔", core_char: "瀲", zhuyin: "ㄌㄧㄢˋ", weight: 5 },
                    { word: "入殮", core_char: "殮", zhuyin: "ㄌㄧㄢˋ", weight: 4 },
                    { word: "寶劍", core_char: "劍", zhuyin: "ㄐㄧㄢˋ", weight: 2 },
                    { word: "眼瞼", core_char: "瞼", zhuyin: "ㄐㄧㄢˇ", weight: 4 },
                    { word: "刑罰太濫", core_char: "濫", zhuyin: "ㄌㄢˋ", weight: 3 },
                    { word: "濫用職權", core_char: "濫", zhuyin: "ㄌㄢˋ", weight: 4 },
                    { word: "軍艦", core_char: "艦", zhuyin: "ㄐㄧㄢˋ", weight: 3 },
                    { word: "窗檻", core_char: "檻", zhuyin: "ㄐㄧㄢˋ", weight: 4 },
                    { word: "門檻", core_char: "檻", zhuyin: "ㄎㄢˇ", weight: 3 },
                    { word: "尷尬", core_char: "尷", zhuyin: "ㄍㄢ", weight: 4 },
                    { word: "堆砌", core_char: "砌", zhuyin: "ㄑㄧˋ", weight: 3 },
                    { word: "沏茶", core_char: "沏", zhuyin: "ㄑㄧ", weight: 3 },
                    { word: "成敗利鈍", weight: 5 },
                    { word: "功敗垂成", weight: 5 },
                    { word: "成事不足敗事有餘", weight: 5 },
                    { word: "成者為王敗者為寇", weight: 5 },
                    { word: "勝不驕敗不餒", weight: 5 },
                    { word: "月盈則食", weight: 5 },
                    { word: "絕處逢生", weight: 5 },
                    { word: "否極泰來", weight: 5 },
                    { word: "樂極生悲", weight: 5 },
                    { word: "興盡悲來", weight: 5 },
                    { word: "苦盡甘來", weight: 5 }
                ]
            },
            "L9": {
                name: "第9課 罐頭由來",
                words: [
                    { word: "循規蹈矩", core_char: "循", zhuyin: "ㄒㄩㄣˊ", weight: 5 },
                    { word: "無所遁形", core_char: "遁", zhuyin: "ㄉㄨㄣˋ", weight: 5 },
                    { word: "遁逃", core_char: "遁", zhuyin: "ㄉㄨㄣˋ", weight: 4 },
                    { word: "盾牌", core_char: "盾", zhuyin: "ㄉㄨㄣˋ", weight: 2 },
                    { word: "後盾", core_char: "盾", zhuyin: "ㄉㄨㄣˋ", weight: 2 },
                    { word: "廝殺", core_char: "廝", zhuyin: "ㄙ", weight: 4 },
                    { word: "小廝", core_char: "廝", zhuyin: "ㄙ", weight: 3 },
                    { word: "聲嘶力竭", core_char: "嘶", zhuyin: "ㄙ", weight: 5 },
                    { word: "撕毀", core_char: "撕", zhuyin: "ㄙ", weight: 3 },
                    { word: "破釜沉舟", core_char: "釜", zhuyin: "ㄈㄨˇ", weight: 5 },
                    { word: "斧頭", core_char: "斧", zhuyin: "ㄈㄨˇ", weight: 2 },
                    { word: "追撞", core_char: "撞", zhuyin: "ㄓㄨㄤˋ", weight: 2 },
                    { word: "大敗", core_char: "敗", zhuyin: "ㄅㄞˋ", weight: 3 }, // 補充：大敗(擊敗/慘敗)
                    { word: "這幢農舍", core_char: "幢", zhuyin: "ㄔㄨㄤˊ", weight: 4 },
                    { word: "書僮", core_char: "僮", zhuyin: "ㄊㄨㄥˊ", weight: 4 },
                    { word: "憧憬", core_char: "憧", zhuyin: "ㄔㄨㄥ", weight: 5 },
                    { word: "著落", core_char: "著", zhuyin: "ㄓㄨㄛˊ", weight: 3 },
                    { word: "著衣", core_char: "著", zhuyin: "ㄓㄨㄛˊ", weight: 3 },
                    { word: "名著", core_char: "著", zhuyin: "ㄓㄨˋ", weight: 2 },
                    { word: "著書立說", core_char: "著", zhuyin: "ㄓㄨˋ", weight: 5 },
                    { word: "顯著", core_char: "著", zhuyin: "ㄓㄨˋ", weight: 3 },
                    { word: "不著店", core_char: "著", zhuyin: "ㄓㄠˊ", weight: 4 },
                    { word: "正說著話", core_char: "著", zhuyin: "ㄓㄜ", weight: 2 },
                    { word: "改弦更張", core_char: "更", zhuyin: "ㄍㄥ", weight: 5 },
                    { word: "三更半夜", core_char: "更", zhuyin: "ㄍㄥ", weight: 3 },
                    { word: "更加努力", core_char: "更", zhuyin: "ㄍㄥˋ", weight: 1 }
                ]
            },
            "L10": {
                name: "第10課 項鍊",
                words: [
                    { word: "瞌睡", core_char: "瞌", zhuyin: "ㄎㄜ", weight: 2 },
                    { word: "磕頭", core_char: "磕", zhuyin: "ㄎㄜ", weight: 3 },
                    { word: "嗑瓜子", core_char: "嗑", zhuyin: "ㄎㄜˋ", weight: 3 },
                    { word: "溘然長逝", core_char: "溘", zhuyin: "ㄎㄜˋ", weight: 5 },
                    { word: "官邸", core_char: "邸", zhuyin: "ㄉㄧˇ", weight: 4 },
                    { word: "詆毀", core_char: "詆", zhuyin: "ㄉㄧˇ", weight: 4 },
                    { word: "抵抗", core_char: "抵", zhuyin: "ㄉㄧˇ", weight: 2 },
                    { word: "抵債", core_char: "抵", zhuyin: "ㄉㄧˇ", weight: 3 },
                    { word: "抵達", core_char: "抵", zhuyin: "ㄉㄧˇ", weight: 2 },
                    { word: "根深柢固", core_char: "柢", zhuyin: "ㄉㄧˇ", weight: 5 },
                    { word: "怦怦", core_char: "怦", zhuyin: "ㄆㄥ", weight: 3 },
                    { word: "抨擊", core_char: "抨", zhuyin: "ㄆㄥ", weight: 4 },
                    { word: "砰的一聲", core_char: "砰", zhuyin: "ㄆㄥ", weight: 2 },
                    { word: "評論", core_char: "評", zhuyin: "ㄆㄧㄥˊ", weight: 2 },
                    { word: "塌陷", core_char: "陷", zhuyin: "ㄒㄧㄢˋ", weight: 2 },
                    { word: "陷害", core_char: "陷", zhuyin: "ㄒㄧㄢˋ", weight: 2 },
                    { word: "陷阱", core_char: "阱", zhuyin: "ㄐㄧㄥˇ", weight: 4 },
                    { word: "豆沙餡", core_char: "餡", zhuyin: "ㄒㄧㄢˋ", weight: 3 },
                    { word: "火焰", core_char: "焰", zhuyin: "ㄧㄢˋ", weight: 2 },
                    { word: "諂媚", core_char: "諂", zhuyin: "ㄔㄢˇ", weight: 5 },
                    { word: "掐脖子", core_char: "掐", zhuyin: "ㄑㄧㄚ", weight: 4 },
                    { word: "拎著菜籃", core_char: "拎", zhuyin: "ㄌㄧㄥ", weight: 3 },
                    { word: "聆聽", core_char: "聆", zhuyin: "ㄌㄧㄥˊ", weight: 3 },
                    { word: "玲瓏", core_char: "玲", zhuyin: "ㄌㄧㄥˊ", weight: 3 },
                    { word: "門鈴", core_char: "鈴", zhuyin: "ㄌㄧㄥˊ", weight: 1 },
                    { word: "請帖", core_char: "帖", zhuyin: "ㄊㄧㄝˇ", weight: 3 },
                    { word: "一帖藥", core_char: "帖", zhuyin: "ㄊㄧㄝˇ", weight: 3 },
                    { word: "妥帖", core_char: "帖", zhuyin: "ㄊㄧㄝ", weight: 4 }
                ]
            },
            "自3": {
                name: "自學3 空城計",
                words: [
                    { word: "一班文官", core_char: "班", zhuyin: "ㄅㄢ", weight: 2 },
                    { word: "輪班", core_char: "班", zhuyin: "ㄅㄢ", weight: 2 },
                    { word: "黑斑", core_char: "斑", zhuyin: "ㄅㄢ", weight: 2 },
                    { word: "妄行出入", core_char: "妄", zhuyin: "ㄨㄤˋ", weight: 4 },
                    { word: "狂妄不羈", core_char: "妄", zhuyin: "ㄨㄤˋ", weight: 5 },
                    { word: "得意忘形", core_char: "忘", zhuyin: "ㄨㄤˋ", weight: 5 },
                    { word: "盲人", core_char: "盲", zhuyin: "ㄇㄤˊ", weight: 2 },
                    { word: "文盲", core_char: "盲", zhuyin: "ㄇㄤˊ", weight: 2 },
                    { word: "盲從", core_char: "盲", zhuyin: "ㄇㄤˊ", weight: 3 },
                    { word: "不出所料", core_char: "料", zhuyin: "ㄌㄧㄠˋ", weight: 3 },
                    { word: "材料", core_char: "料", zhuyin: "ㄌㄧㄠˋ", weight: 1 },
                    { word: "學科", core_char: "科", zhuyin: "ㄎㄜ", weight: 1 },
                    { word: "金科玉律", core_char: "科", zhuyin: "ㄎㄜ", weight: 5 },
                    { word: "顫抖", core_char: "抖", zhuyin: "ㄉㄡˇ", weight: 3 },
                    { word: "言訖", core_char: "訖", zhuyin: "ㄑㄧˋ", weight: 4 },
                    { word: "屹立不搖", core_char: "屹", zhuyin: "ㄧˋ", weight: 5 },
                    { word: "迄無音訊", core_char: "迄", zhuyin: "ㄑㄧˋ", weight: 4 },
                    { word: "迄今", core_char: "迄", zhuyin: "ㄑㄧˋ", weight: 3 },
                    { word: "望西城", core_char: "望", zhuyin: "ㄨㄤˋ", weight: 2 },
                    { word: "望北山路", core_char: "望", zhuyin: "ㄨㄤˋ", weight: 2 },
                    { word: "登城望之", core_char: "望", zhuyin: "ㄨㄤˋ", weight: 2 },
                    { word: "止有一班", core_char: "止", zhuyin: "ㄓˇ", weight: 4 },
                    { word: "遂止住", core_char: "止", zhuyin: "ㄓˇ", weight: 3 },
                    { word: "故作此態", core_char: "故", zhuyin: "ㄍㄨˋ", weight: 4 },
                    { word: "何故", core_char: "故", zhuyin: "ㄍㄨˋ", weight: 3 },
                    { word: "孔明乃披鶴氅", core_char: "乃", zhuyin: "ㄋㄞˇ", weight: 3 },
                    { word: "司馬懿乃魏之名將", core_char: "乃", zhuyin: "ㄋㄞˇ", weight: 4 },
                    { word: "果見", core_char: "見", zhuyin: "ㄐㄧㄢˋ", weight: 2 },
                    { word: "見如此模樣", core_char: "見", zhuyin: "ㄐㄧㄢˋ", weight: 2 },
                    { word: "若某等之見", core_char: "見", zhuyin: "ㄐㄧㄢˋ", weight: 4 },
                    { word: "為司馬懿所擒", core_char: "為", zhuyin: "ㄨㄟˊ", weight: 4 },
                    { word: "吾若為司馬懿", core_char: "為", zhuyin: "ㄨㄟˊ", weight: 3 },
                    { word: "皆為輕重", core_char: "為", zhuyin: "ㄨㄟˊ", weight: 4 }
                ]
            }
        };

        // --- 變數與DOM元素 ---
        const lessonSelect = document.getElementById('lesson-select');
        const crystalBall = document.getElementById('crystal-ball');
        const wordDisplay = document.getElementById('word-display');
        const messageArea = document.getElementById('message-area');
        const counterArea = document.getElementById('counter-area');
        const historyList = document.getElementById('history-list');
        const historyContainer = document.getElementById('history-container');
        const resetBtn = document.getElementById('reset-btn');
        const sparkleContainer = document.getElementById('sparkle-container');

        let currentWordPool = [];
        let drawnWords = [];
        let totalUniqueWords = 0;
        let isDrawing = false; 

        // --- 音效合成器 ---
        const synth = new Tone.Synth({
            oscillator: { type: 'sine' },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 }
        }).toDestination();
        
        const sparkleSynth = new Tone.PolySynth(Tone.PluckSynth).toDestination();
        sparkleSynth.set({ volume: -8 });

        // --- 函式 ---
        function populateLessons() {
            for (const key in lessonsData) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = lessonsData[key].name;
                lessonSelect.appendChild(option);
            }
        }

        function setLesson() {
            const lessonKey = lessonSelect.value;
            drawnWords = [];
            updateHistory();

            if (!lessonKey) {
                currentWordPool = [];
                totalUniqueWords = 0;
                wordDisplay.innerHTML = '';
                wordDisplay.classList.remove('show');
                crystalBall.classList.add('disabled');
                messageArea.textContent = '請先選擇一課來啟動水晶球';
                counterArea.textContent = '';
                return;
            }

            const words = lessonsData[lessonKey].words;
            currentWordPool = [];
            
            // 根據權重將詞語加入池中
            words.forEach(wordObj => {
                for (let i = 0; i < wordObj.weight; i++) {
                    currentWordPool.push(wordObj.word);
                }
            });
            
            totalUniqueWords = new Set(words.map(w => w.word)).size;
            
            crystalBall.classList.remove('disabled');
            wordDisplay.innerHTML = '點我抽詞';
            wordDisplay.classList.add('show');
            messageArea.textContent = `已選擇「${lessonsData[lessonKey].name}」，水晶球已啟動！`;
            counterArea.textContent = `已抽出 0 / ${totalUniqueWords} 個`;
        }

        async function drawWord() {
            if (crystalBall.classList.contains('disabled') || isDrawing) return;
            
            // 解決 iPad 音效問題：在每次使用者互動時檢查並啟動音訊
            if (Tone.context.state !== 'running') {
                await Tone.start();
            }

            isDrawing = true;

            if (currentWordPool.length === 0) {
                messageArea.textContent = '所有詞語都已經抽完囉！';
                wordDisplay.innerHTML = '完成！';
                crystalBall.classList.add('disabled');
                synth.triggerAttackRelease("C5", "0.5");
                isDrawing = false;
                return;
            }

            wordDisplay.classList.remove('show');
            
            const now = Tone.now();
            synth.triggerAttackRelease("G4", "0.2", now);
            synth.triggerAttackRelease("C5", "0.2", now + 0.1);
            synth.triggerAttackRelease("E5", "0.3", now + 0.2);

            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * currentWordPool.length);
                const selectedWord = currentWordPool[randomIndex];
                
                const lessonKey = lessonSelect.value;
                const wordObj = lessonsData[lessonKey].words.find(w => w.word === selectedWord);
                
                let displayText = wordObj.word;
                if (wordObj.zhuyin && wordObj.core_char) {
                    const replacement = `${wordObj.core_char}<span class="text-lg opacity-80">（${wordObj.zhuyin}）</span>`;
                    displayText = wordObj.word.replace(wordObj.core_char, replacement);
                }

                wordDisplay.innerHTML = displayText;
                wordDisplay.classList.add('show');
                
                createSparkles();

                if (!drawnWords.includes(selectedWord)) {
                    drawnWords.push(selectedWord);
                    updateHistory();
                }

                // 移除池中所有該詞語的實例，確保不重複抽出
                currentWordPool = currentWordPool.filter(word => word !== selectedWord);
                
                counterArea.textContent = `已抽出 ${drawnWords.length} / ${totalUniqueWords} 個`;
                messageArea.textContent = '水晶球已啟動！';
                
                isDrawing = false;

            }, 400);
        }

        function updateHistory() {
            historyList.innerHTML = '';
            if (drawnWords.length > 0) {
                historyContainer.classList.remove('hidden');
                const reversedWords = [...drawnWords].reverse();
                const lessonKey = lessonSelect.value;
                
                reversedWords.forEach((word, index) => {
                    const wordObj = lessonsData[lessonKey].words.find(w => w.word === word);
                    
                    let displayText = wordObj.word; 
                     if (wordObj.zhuyin && wordObj.core_char) {
                        const replacement = `${wordObj.core_char}<span class="text-base opacity-80">（${wordObj.zhuyin}）</span>`;
                        displayText = wordObj.word.replace(wordObj.core_char, replacement);
                    } else if (wordObj.zhuyin) {
                        displayText = `${wordObj.word}（${wordObj.zhuyin}）`;
                    }

                    const item = document.createElement('div');
                    item.className = 'history-item flex items-center gap-4';
                    
                    const numberSpan = document.createElement('span');
                    numberSpan.className = 'text-lg font-bold text-yellow-400/80';
                    numberSpan.textContent = `${drawnWords.length - index}.`;
                    
                    const wordSpan = document.createElement('span');
                    wordSpan.innerHTML = displayText;

                    item.appendChild(numberSpan);
                    item.appendChild(wordSpan);
                    historyList.appendChild(item);
                });
            } else {
                historyContainer.classList.add('hidden');
            }
        }

        function createSparkles() {
            const now = Tone.now();
            for (let i = 0; i < 15; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                const angle = Math.random() * Math.PI * 2;
                const radius = Math.random() * 125;
                sparkle.style.top = `${125 + Math.sin(angle) * radius - 2}px`;
                sparkle.style.left = `${125 + Math.cos(angle) * radius - 2}px`;
                sparkle.style.animationDelay = `${Math.random() * 0.5}s`;
                sparkleContainer.appendChild(sparkle);
                
                sparkleSynth.triggerAttackRelease("C6", "8n", now + i * 0.03);

                setTimeout(() => {
                    sparkle.remove();
                }, 1500);
            }
        }

        // --- 事件監聽 ---
        document.addEventListener('DOMContentLoaded', populateLessons);
        lessonSelect.addEventListener('change', setLesson);
        crystalBall.addEventListener('click', drawWord);
        resetBtn.addEventListener('click', setLesson);

        setLesson();
    </script>
</body>
</html>
